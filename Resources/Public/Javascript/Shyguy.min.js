function getCaretPosition(e){if(document.selection){e.focus();var t=document.selection.createRange(),n=t.text.length;t.moveStart("character",-e.value.length);var r=t.text.length-n;return{start:r,end:r+n}}return e.selectionStart||"0"==e.selectionStart?{start:e.selectionStart,end:e.selectionEnd}:{start:0,end:0}}function replaceRange(e,t,n,r){return e.substring(0,t)+r+e.substring(n)}require(["jquery","ckeditor"],function(e){e(document).ready(function(){e('a[href="#insertSoftHyphen"]').length&&e('a[href="#insertSoftHyphen"]').on("mousedown",function(t){t.preventDefault();let n,r=document.activeElement,a=e(r);for(let t in CKEDITOR.instances)a.closest(".form-wizards-element #"+e(CKEDITOR.instances[t].container).attr("id")).length&&(n=CKEDITOR.instances[t].dataProcessor.editor);if(n&&"source"!==n.mode&&!0===n.focusManager.hasFocus)n.insertText("↵");else{let e=getCaretPosition(r);a.val(replaceRange(a.val(),e.start,e.end,"↵")),a.change(),a.keyup()}}),e('body :not(script,textarea), body textarea[id^="formengine-textarea-"]').contents().filter(function(){return 3===this.nodeType}).replaceWith(function(){return this.nodeValue.replace(/(\&shy;|\­)/gi,"↵").replace(/[\u00A0-\u9999<>\&]/g,function(e){return"&#"+e.charCodeAt(0)+";"})}),e('input, .form-wizards-element textarea[id^="formengine-textarea-"]').each(function(){e(this).val(e(this).val().replace(/(\&shy;|\­)/gi,"↵"))}),CKEDITOR.on("instanceReady",function(e){e.editor.setData(e.editor.getData().replace(/(\&shy;|\­)/gi,"↵"))})})});